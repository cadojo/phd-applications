<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.510">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph D Carpinelli">
<meta name="dcterms.date" content="2023-12-05">
<meta name="description" content="MIT Department of Physics">

<title>PhD Application Letters - Statement of Purpose</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../../../images/manifolds-seaborn_colorblind.png" rel="icon" type="image/png">
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../formatting/styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">PhD Application Letters</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="dropdown-header">
 <span class="menu-text">Thank you!</span></li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summary-of-objectives" id="toc-summary-of-objectives" class="nav-link active" data-scroll-target="#summary-of-objectives">Summary of Objectives</a></li>
  <li><a href="#robotics-research" id="toc-robotics-research" class="nav-link" data-scroll-target="#robotics-research">Robotics Research</a></li>
  <li><a href="#dynamics-research" id="toc-dynamics-research" class="nav-link" data-scroll-target="#dynamics-research">Dynamics Research</a></li>
  <li><a href="#numerical-simulations" id="toc-numerical-simulations" class="nav-link" data-scroll-target="#numerical-simulations">Numerical Simulations</a></li>
  <li><a href="#research-aspirations" id="toc-research-aspirations" class="nav-link" data-scroll-target="#research-aspirations">Research Aspirations</a></li>
  <li><a href="#future-aspirations" id="toc-future-aspirations" class="nav-link" data-scroll-target="#future-aspirations">Future Aspirations</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Carpinelli —&nbsp;Statement of Purpose.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="Carpinelli —&nbsp;Statement of Purpose.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Statement of Purpose</h1>
</div>

<div>
  <div class="description">
    MIT Department of Physics
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joseph D Carpinelli <a href="mailto:joey@carpinelli.email" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 5, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="summary-of-objectives" class="level1">
<h1>Summary of Objectives</h1>
<p>My first simulation study at NASA’s Flight Sciences Lab produced puzzling results. Unexpected bifurcations had emerged in the dispersed spacecraft trajectories, and with hundreds of models integrated by thousands of engineers, the cause was unclear. I have since learned to consult previous studies, and isolate models to explain emergent dynamical effects. Now, I hope to build and execute similar simulation studies to explain and predict observations of galaxy &amp; stellar evolution, the universe’s large-scale structure, and other astrophysical phenomena.</p>
<p>Astrophysical simulations produce domain-specific results, but their development demands expertise across many computational and scientific disciplines. With cultivated expertise in computational labs, and scientific research teams, MIT is uniquely prepared to drive this moment in astronomy and train the next generation of astrophysicists. I hope you will consider me for admission to this training as part of the MIT Department of Physics’ Doctoral Program. My experience across multiple disciplines, including scientific software development and nonlinear dynamics, has prepared me for the interdisciplinary work of computational astrophysics research.</p>
</section>
<section id="robotics-research" class="level1">
<h1>Robotics Research</h1>
<p>I led software development in Dr.&nbsp;Dave Akin’s Space Systems Lab (SSL) for four years cumulatively as an undergraduate student, and as a graduate Dean’s Fellowship recipient and research assistant. SSL’s primary application, an 8DOF dexterous manipulator known as Ranger, required consistently fast and precise control loops. As I developed kinematic solvers and Cartesian controllers for Ranger, I learned techniques for improving mathematical software: parallelism for reducing jitter, in-place calculations for avoiding allocation, and careful benchmark design for algorithm selection. I presented benchmarks for one such selection in a research paper: analytical Jacobian codes, generated with my personal contributions to Julia’s <code>Symbolics.jl</code>, which halved computation time relative to iterative methods. After applying these techniques, Ranger successfully completed spacecraft manipulation demos, and I developed fluency in scientific software development.</p>
</section>
<section id="dynamics-research" class="level1">
<h1>Dynamics Research</h1>
<p>I had always enjoyed courses related to dynamical systems, but I thrived when my graduate astrodynamics coursework encouraged computational methods. My Interplanetary Navigation &amp; Guidance term project replicated halo orbit and invariant manifold solvers, as summarized by Megan Rund’s <a href="https://digitalcommons.calpoly.edu/theses/1853/">thesis</a>. Multiple differential correction flavors are documented in literature, but I found no guidance for algorithm selection. My final paper mapped desired orbit characteristics to compatible solvers, announced several open-source Julia <a href="https://github.com/cadojo/GeneralAstrodynamics.jl">packages</a>, and presented over 130k <a href="https://github.com/cadojo/CR3BP-Manifold-Research">initial conditions</a> for periodic orbits. I was thrilled to find true low-energy trajectories throughout our solar system with laptop-scale computation. After presenting this work at <a href="https://youtu.be/WnvKaUsGv8w?si=GaO9QXEtBId9USVm">JuliaCon 2021</a>, I was invited to join the <code>JuliaSpace</code> organization to collaborate with other astrodynamics researchers across the world, including Germany and Japan.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="numerical-simulations" class="level1">
<h1>Numerical Simulations</h1>
<p>As my engineering research and professional interests shifted toward nonlinear dynamics, computation quickly became my most productive tool. <a href="https://julialang.org">Julia’s</a> open-source modeling, simulation, and symbolic manipulation packages were particularly helpful for exploring smaller dynamical systems’ structure and solutions. I am proud to have brought several astrophysical models into Julia’s ecosystem with <a href="https://github.com/cadojo/AstrodynamicalModels.jl"><code>AstrodynamicalModels.jl</code></a> and <a href="https://github.com/cadojo/GalacticPotentials.jl"><code>GalacticPotentials.jl</code></a>; after professionally developing similar capabilities for the Artemis Program, I received a Superior Achievement Award from the NASA Johnson Space Center (JSC) Director.</p>
<p>As a flight dynamics engineer, I was primarily responsible for characterizing and improving integrated spacecraft performance with numerical simulations. This work required all relevant dynamical effects to be modeled, including flexible structure &amp; separation dynamics, propellant slosh, and sensor noise. I routinely modified dynamical models, and executed tens of thousands of Monte Carlo simulations to determine the vehicle performance’s sensitivity. I found talent in this work; after applying the same approach to control parameter tuning efforts, I delivered parameter values which substantially improved vehicle performance, and documented the macro-dynamical effects with more than 150 pages of technical reports.</p>
`<!--

I want to share that I am good at software, I love open-source, and I have positively contributed professionally.

Though I developed similar tools within NASA's Johnson Space Center, and received a Superior Achievement Award from the Center Director for doing so, most of my professional contributions demanded more computational power. As a member of the Integrated GN&C Analysis Branch, I defined and executed simulation studies using NASA's massive 6DOF nonlinear simulation framework: ANTARES.

Narratively, my story is that I have applied these skills to exploration, and I now want to apply these skills to discovery.

Paragraph 1 should be resume. Paragraph 2 should be narrative. But paragraph 1 should appropriately set up paragraph 2.

# Paragraph #1

There are two common connections between my research and professional work: computation, and exploration. Computation in service of exploration. I share open-source software, and foster that in NASA. I have received kudos for doing so. But space exploration is becoming less and less technology development, and more and more logistics.


After using open-source software in my engineering research, and
learning from many researchers in the scientific software community, I
am proud to have personally contributed back more than a dozen
open-source Julia & Python packages. I have professionally encouraged
community development by installing private package servers, giving
technical talks, and developing internal packages within NASA. One such
package, a novel 6DOF kinematics simulator, earned an Outstanding
Performance Award from the Center Director of Engineering. These
software design techniques are important for computational scientists to
consider; simplified simulation usage encourages faster model
exploration, and more productive research.

For three years, I have supported the Artemis Program as a flight
dynamics & controls engineer at NASA's Johnson Space Center (JSC).

defined & executed tens of thousands of Monte Carlo simulations. I found
talent in this work; I successfully identified the cause of emergent
vehicle behaviors, and selected control parameter values which
substantially improved simulated vehicle performance. I documented this
achievement over six months with 150 pages of technical reports,
approved and submitted to the Artemis Program.

I have developed these dynamics and scientific software skills while
becoming increasingly aware of this moment in astronomy. -->
</section>
<section id="research-aspirations" class="level1">
<h1>Research Aspirations</h1>
<p>In my three years at NASA, I have come to understand the space industry’s shrinking — and astronomy’s growing — need for computational methods. My interest in space science has long been fueled by astronomers’ social media posts, and popular science magazines. I have been thrilled to recently learn that my technical skill-set may serve the cause of discovery through computational astronomy &amp; astrophysics research.</p>
<p>NASA’s flight dynamics simulations echo elements of Dr.&nbsp;Vogelsberger’s massive astrophysical <a href="https://www.tng-project.org">simulations</a>; both study macro-dynamical consequences of known or hypothesized physical laws. After conducting dynamical sensitivity studies as an engineer, I have been encouraged to find similar methods used in astrophysics research, such as Dr.&nbsp;Josh Borrow’s <a href="https://arxiv.org/pdf/2212.03255.pdf">characterization</a> of the impact of the epoch of reionization on early galaxy formation during his post-doctorate tenure at MIT. I hope to discuss similar such studies with my advisor, and quantify the impact of other feedback effects, e.g. galaxy evolution’s sensitivity to radiation pressure and stellar winds, gas flows, galaxy clustering, and possible properties of dark matter. I am similarly excited by the opportunity to contribute to Dr.&nbsp;Necib’s study of dark matter, and its intersections with galactic dynamics and structure formation.</p>
<p>MIT’s position as a leader of astrophysics research is further strengthened by its breadth of cultivated technical expertise, including that within the <a href="https://julia.mit.edu">Julia Lab</a>. I am interested in exploring how Julia’s revolutionary modeling &amp; simulation codes may accelerate astrophysical simulations, and aid projects such as Dr. Millholland’s data-driven approach to stellar formation modeling. If my advisor found similar ideas promising, I would welcome cross-department collaborations in the pursuit of novel science.</p>
</section>
<section id="future-aspirations" class="level1">
<h1>Future Aspirations</h1>
<p>With leaders in computational research, physics, mathematics, and other technical fields, MIT is uniquely suited to drive this moment in astronomy. I hope to have the opportunity to learn from this expertise. Thank you for your consideration.</p>
<div style="page-break-after: always;"></div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("phd\.loopy\.codes");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>